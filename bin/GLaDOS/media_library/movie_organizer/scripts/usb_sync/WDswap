#!/bin/bash
for f in /root/.bin/lib/*; do source $f; done

dbName="VideoLibrary"
dbOptions="-D $dbName -s -r -N"

output="scanresults.txt"
### - Find local path (See /root/.bin/lib/.localize) ###
SOURCE="${BASH_SOURCE[0]}"
while [ -h "$SOURCE" ]; do 
 DIR="$( cd -P "." && pwd )"
 SOURCE="$(readlink "$SOURCE")"
  [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE"
done
DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )"

WorkingDir=`pwd "$1"`
InputFile="$WorkingDir/$1"
Title=`basename "$InputFile"`
Title=${Title:0:$((${#Title}-4))}
#echo "$InputFile"
#echo "searching $Title"

VQ=`echo $(/root/.bin/local/height "$InputFile") |awk '{print $5}'`
Wsize=`echo $(ls -lh "$WorkingDir" |grep "$Title" |awk '{print $5}')`

Query="select title, video_quality, filesize from movies where title like '%$Title%' limit 1"
Query2="select video_quality from movies where title like '%$Title%'"

RT=$(echo "$Query" | mysql $dbOptions)
#RQ=$(echo "$Query2" | mysql $dbOptions)

#echo "-------" >> $output
echo "WD:      $Title : $VQ : $Wsize"
echo "GLaDOS:  $RT"
echo ""



