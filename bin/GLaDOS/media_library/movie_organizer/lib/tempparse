#!/bin/bash
########################################
### parseFilename
### Pulls out the Title, Year, Size,
### Quality, and runtime of the
### filename passed to it
########################################
function parseFilename() {
 stringZ="$1"
 while [[ $stringZ == *"/"* ]]; do
  slash=`expr index "$stringZ" "/"`
  stringZ=${stringZ:$slash}
  #echo "cut string down to $string"
 done

 if [ "${stringZ:0:1}" == "[" ]; then
	endBrack=`expr index "$stringZ" "]"`
	if [ $endBrack -gt 0 ]; then
	 stringZ=${stringZ:$endBrack}
	fi
 fi

 stringZ=`echo "$stringZ" |sed 's/\./\ /g'`
  arr=($stringZ)
  arr_len=${#arr[@]}
  arr_len=$((arr_len-1))
  FileType=${arr[$arr_len]}
 index=0

 for x in ${arr[@]}
  do
   word="$x"
	## DEBUG ##
	##   echo -e "Processing ${yellow} $word ${NC}"
   if [ "${word:0:2}" = "19" ] || [ "${word:0:2}" = "20" ] || [ "${word:1:2}" = "19" ] || [ "${word:1:2}" = "20" ] && [ "${word:0:1}" != "7" ]; then
        if [ "${word:0:1}" = "(" ]; then
                word=${word:1:$((${#word}-2))}
        fi
	##   echo -e "Year is ${yellow} $word ${NC}"
      Year="$word"
      titleCount=0
      while [ $titleCount -lt $index ]; do
         Title="$Title ${arr[$titleCount]}"
         titleCount=$((titleCount+1))
      done
      Title=${Title:0}
	index=$((index+1))
   elif [ ${word:0:5} = "1080p" ] || [ ${word:0:4} = "720p" ]; then
         Quality="$word"
	index=$((index+1))
   fi
   index=$((index+1))
  done

 if [ "$Title" == "" ]; then
	loop=${#arr[@]}
	loop=$((loop-1))
	c=0
	for y in ${arr[@]}; do
		if [ $c -lt $loop ]; then	 
		 Title="$Title $y"
		 c=$((c+1))
		fi
	done
 fi

 if [ "${Title:0:1}" == " " ]; then
        Title=${Title:1}
 fi

echo "title: $Title"
echo "year: $Year"


} #END parseFilename

parseFilename "$1"
