#!/bin/bash

### Build a table ###
### Options are:
### build_table <group members> <title> <table order > <number of columns>
### group memebers should be a comma seperated list:  ie Cortana,Wheatley,BB8
### table order will append a number to the filename to change the order of
### printout

function build_table(){
 if [ "$2" == "" ]; then 
   output="$TABLES/tmp.table"
 else
   if [ "$3" != "" ]; then
    output="$TABLES/$3_$(echo $2|sed 's/ /_/g').table"
   else
    output="$TABLES/$(echo $2|sed 's/ /_/g').table"
   fi
   if [ -f "$output" ]; then rm -rf "$output";fi
   gtitle="$2"; banner "$gtitle" "${output}" "centered"
 fi
 if [ "$4" == "" ]; then cols=2; else cols="$4";fi

 s=$(log_action "$gtitle" "start")
 echo -en "$(tail -1 $LOGFILE)"
 cnt=1
 IFS=','
 read -ra host <<< "$1"
 ## Loop through hosts and check them
 for i in "${host[@]}"; do
  if [ $cnt -lt $cols ]; then
    #check for last element and add carriage return if needed
    lastOne="${host[*]: -1}"
   if [ "$i" == "$lastOne" ]; then
    echo -e "$(isOnline $i)  " >> $output
   else
    echo -en "$(isOnline $i)  " >> $output
   fi
    cnt=$(($cnt+1))
  else
     echo -e "$(isOnline $i)" >> $output
     cnt=1
  fi
 done
 echo -e "${white}+------------------------------------------------------------------------------------------" >> $output
 t=$(($(date +%s)-$s))
 e=$(log_action "[$t seconds]" "end")
 RunningTime=$(($RunningTime+$t))
 echo -e "[Done] ($t seconds)"
} ##build_table

