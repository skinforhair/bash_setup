#!/bin/bash

source $pLIB/colors

ca[1]=${red}
ca[2]=${green}
ca[3]=${yellow}
ca[4]=${Blue}
ca[5]=${Purple}
ca[6]=${BWhite}
ca[7]=${URed}
ca[8]=${UYellow}
ca[9]=${UGreen}
ca[10]=${UBlue}

sa=
cnt=

function contains() {
 ret=""
 for i in "${!sa[@]}"; do
   if [[ "${sa[$i]}" = "${1}" ]]; then
       ret=$(echo "${i}")
   fi
 done
echo "$ret"
}

##create ignore list for shows already converted
IGNORELIST=completed_converted_shows.txt
stringG=""
if [ -e "$IGNORELIST" ]; then
while read line; do
 if [ "$line" != "" ] && [ "${line:0:1}" != "#" ]; then
  if [ "$stringG" == "" ]; then
    stringG="$line"
  else
    stringG="$stringG|$line"
  fi
 fi
done <$IGNORELIST
fi
#echo "stringG: $stringG"

if [ "$1" != "" ]; then
   SHOWLIM="$1"
else
 SHOWLIM=15
fi
TMP=/tmp/seasonlist.tmp


if [ -a $TMP ]; then rm -f $TMP; fi
stringG="SVU"
find /shares/video/tv/ -maxdepth 1 -type d -print0 |xargs -0 du -h -sk |egrep -v "($stringG)" |sort -rn |head -$SHOWLIM >> $TMP
c=1
echo -e "Size:\tSeasons:\t\tAvg Sz:\t\tShow:"
echo "------------------------------------------------------------------"
while read line; do
 SIZE=$(echo "$line" |awk '{print $1}')
 stringZ=${line:$((${#SIZE}+1))}
 NFILES=$(ls "$stringZ" |grep -v jpg|wc -l |awk '{print $1}')
 GB=$(du -sh "$stringZ" |awk '{print $1}')

 stringY=${line:$((${#SIZE}+18))}
 slash=`expr index "$stringY" /`
 #SHOWNAME=${stringY:0:$(($slash-1))}
 SHOWNAME="$stringY"
 ShowIndex=$(contains "$SHOWNAME")
 if [ "$ShowIndex" == "" ]; then
  ShowIndex=${#sa[@]} 
  sa[$ShowIndex]="$SHOWNAME"
  cnt[$ShowIndex]=1
 else
  cnt[$ShowIndex]=$((${cnt[$ShowIndex]}+1))
 fi
  SHOWNAME="${ca[$ShowIndex]}$SHOWNAME${NC}"


 AVG=$((SIZE/$NFILES))
 AVG=$((AVG/1024))

 if [ $AVG -gt 6000 ]; then
   AVG="${red}$AVG${NC}"
 elif [ $AVG -gt 3600 ]; then
   AVG="${yellow}$AVG${NC}"
 fi
 echo -e "$c: $GB\t$NFILES\t$AVG\t$SHOWNAME"
 c=$((c+1))
done < $TMP

if [ -a $TMP ]; then rm -f $TMP; fi
