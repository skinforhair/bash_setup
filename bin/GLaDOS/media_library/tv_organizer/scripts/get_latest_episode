#!/bin/bash
for f in $pLIB/*; do if [ -f $f ]; then source $f;fi; done

DIR="$pBIN/GLaDOS/media_library/tv_organizer/scripts"
output_file="$DIR/latest_episodes.txt"


function printShow(){ 
   id=$(echo "$1" |awk '{print $1}')
   if [ "$id" != "id" ]; then
    ep=$(echo "$1" |awk '{print $3}')
    se=$(echo "$1" |awk '{print $2}')
    sn=$(echo "$1" |awk '{$1=$2=$3=""; print $0}'|awk '{$1=$1}1')
    ti=$(echo "select title from VideoLibrary.TV_feed where showID=$id and season=$se and episode=$ep" |mysql -N)
    echo -e "$yellow$sn$NC ($blue$id$NC): S$green$se$NC E$blue$ep$NC -- \"$gray$ti$NC\""
   else
    echo -e "$yellow Show$NC ($blue$id$NC): $green Season$NC $blue Episode$NC -- \"$gray""Title$NC\""
   fi
} #printShow


if [ "$1" == "" ]; then
 echo -e "$red All Shows: $NC"
 while read show; do
  printShow "$show"
 done < $output_file
else
 numlines=$(grep -i "$1" $output_file |wc -l)
 foundline=$(grep -i "$1" $output_file)
 if [ "$foundline" == "" ]; then
   echo "No title found for \"$1\" !"
   exit 1
 elif [ $numlines -gt 1 ]; then
   echo "Found $numlines Results for $1!"
    echo "$foundline"
   exit 1
 else
   printShow "$foundline"
 fi
# title=$(echo "$line" |awk '{$1=$2=$3=""; print $0}'|awk '{$1=$1}1')
fi

