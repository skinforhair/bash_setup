#!/bin/bash
function firewalld_add_country(){
 [ "$1" == "" ] && usage "add" "$1"
 XMLfile=$(grep "<short>${1,,}</short>" ${gIPSETS}/*|head -1|awk '{print $1}')
 # [ "$XMLfile" == "" ] && usage "add" "$1"

if [ "$XMLfile" != "" ]; then
 #remove path
 XMLfile=${XMLfile##*/}
 XMLfile=${XMLfile:0:$((${#XMLfile}-1))}
  echo -en "Copying $XMLfile to ${FWD_IPSETS} ...  "
   cp -f ${gIPSETS}/${XMLfile} ${FWD_IPSETS}
 XMLfile=${XMLfile:0:$((${#XMLfile}-4))}
   echo -en "and inserting $XMLfile into $DROP_ZONE ..."
   echo "[DONE]."

 if ! [ -f "$DROP_ZONE" ]; then
  firewall-cmd --permanent --zone=drop --add-source=ipset:$XMLfile
 else
  stringZ="  <source ipset=\"${XMLfile}\"/>"
  Nlines=$(cat $DROP_ZONE|wc -l|awk '{print $1}')
   sed -i.old -e "${Nlines}i${stringZ}" $DROP_ZONE
 fi
else
 echo "No Country found for $1 .. SKIPPING!"
fi
} ##firewalld_add_country

