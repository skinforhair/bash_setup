#!/bin/bash

#MovieInput=janet_movies
#TVInput=janet_tv


MovieInput="$1"

remaining_available=$(df |grep sdh|awk '{print $4}')

#colors
 NC='\033[0m' # no color
 red='\033[0;31m'
 green='\033[0;32m'
 black='\033[0;30m'
 white='\033[1;37m'
 yellow='\033[1;33m'
 cyan='\033[0;36m'
 gray='\033[0;37m'
 blue='\033[0;34m'


function read_file_size(){
 sz=0
 c=0
 spinner=1
 inputfile="$1"
 filetype="$2"

 numLines=$(wc $inputfile|awk '{print $1}')

while read line; do
 c=$((c+1))

#get percentage and format
 perc=$(echo "scale=2; $c*100/$numLines" |bc)
 perc=${perc:0:2}
  if [ "${perc:1:1}" == "." ]; then
   perc=${perc:0:1}
  fi
  if [ "${perc:0:1}" == "." ]; then
   perc="00"
  elif [ $perc -lt 10 ]; then
   perc="0$perc"
  fi

#spinner
 case "$spinner" in
  "1") echo -en "|";if [ $(( $c % 9)) -eq 0 ]; then spinner=2;fi;; 
  "2") echo -en "/";if [ $(( $c % 9)) -eq 0 ]; then spinner=3;fi;; 
  "3") echo -en "-";if [ $(( $c % 9)) -eq 0 ]; then spinner=4;fi;; 
  "4") echo -en "\\";if [ $(( $c % 9)) -eq 0 ]; then spinner=1;fi;; 
 esac

echo -en "["

#colors
  if [ $perc -lt 33 ]; then
   echo -en "${red}"
  elif [ $perc -lt 66 ]; then
   echo -en "${yellow}"
  else
   echo -en "${green}"
  fi

echo -en "$perc${NC}%] "
  n=0;while [ $n -le $c ]; do
    echo -en "."
    n=$(($n+17))
  done
  [ -f "/shares/video/$filetype/$line/" ] && s=$(du -s "/shares/video/$filetype/$line/"|awk '{print $1}') || s=0
 if [ -d "/shares/incoming/moviebox/$filetype/$line/" ]; then
   s1=$(du -s "/shares/incoming/moviebox/$filetype/$line/"|awk '{print $1}')
   s=$(($s-$s1))
 fi

 sz=$(($sz+$s))

echo -en "${NC}\\r"
done < $inputfile
echo ""

myDiff=$(($remaining_available-$sz))
myDiff=$(echo "scale=2; $myDiff/1024/1024" |bc)

if [ "${myDiff:0:1}" == "-" ]; then
 echo -e "You are short by ${red}${myDiff:1}${NC} GB"
else
 echo -e "You have ${green}${myDiff}${NC} GB Available!"
fi

} #read_file_size


read_file_size "$MovieInput" "movies"

