#!/bin/bash

function makeArray() {
inputFile="$1"

i=1
s=1
declare -a arr
while read -r line 
do
    # If we find an empty line, then we increase the counter (i), 
    # set the flag (s) to one, and skip to the next line
    [[ $line == "" ]] && ((i++)) && s=1 && continue 

    # If the flag (s) is zero, then we are not in a new line of the block
    # so we set the value of the array to be the previous value concatenated
    # with the current line
    [[ $s == 0 ]] && arr[$i]="${arr[$i]}
$line" || { 
            # Otherwise we are in the first line of the block, so we set the value
            # of the array to the current line, and then we reset the flag (s) to zero 
            arr[$i]="$line"
            s=0; 
    }
done < "$inputFile"


echo "size is ${#arr[@]}"

if false; then
for i in "${arr[@]}"
do
   echo "|$i"
done 

output=
j=0
while [ $j -lt ${#arr[@]} ]; do
	i=${arr[$j]}
	IFS=$'\n' readarray -t S <<<"$i"
	 Index=${S[0]}
	 Timestamp=${S[1]}
	  startTime={$Timestamp:0:12}
	  endTime=${Timestamp:17:12}
	 myText=${S[2]}
	 for t in 3 4 5 6; do
	  if [ "${S[t]}" != "" ]; then
	 	myText="$myText${S[t]}"
	  fi
	 done
	j=$((j+1))
	 if [ $j -gt 1 ]; then
		echo "$output|"
	 fi
	echo "$output$Index^$startTime^$endTime^$myText|"
done
#echo "$output"
fi
}

