#!/bin/bash

function dl_etn_account_json(){
 hours=1
 minutes=$(($hours*60))
if ! [ -f $ETN_ACCT ] || [ "$(find $ETN_ACCT -mmin +$minutes)" != "" ]; then
 worker=$(curl -s -X GET --header "Accept: application/json" "https://api.etn.spacepools.org/v1/stats/address/$ETNwallet")
 echo "$worker" > $ETN_ACCT
fi
} ##dl_etn_account_json


function etn_account(){
   dl_etn_account_json
pending=$(cat $ETN_ACCT|jq -r '.stats|.balance')
 pending=$(echo "scale=2; $pending/100"|bc)

acctTotal=$(cat $ETN_ACCT|jq -r '.stats|.paid')
 acctTotal=$(echo "scale=2; $acctTotal/100"|bc)
 ## add in other sources of ETN
 FULLTotal=$(echo "scale=2; $acctTotal+$ExtraETN"|bc)

curVal=$(etn_current etn-val)
usdVal=$(echo "scale=2; $FULLTotal*$curVal"|bc)
minedVal=$(echo "scale=2; $acctTotal*$curVal"|bc)

estimated_hashrate=$(cat $ETN_ACCT|jq -r '.stats|.hashrate')
 estimated_hashrate=$(echo "$estimated_hashrate"|awk '{print $1}')


case "${1,,}" in
 "etn-act") echo -en "${white}$acctTotal${NC} Spacepools + ${white}$ExtraETN${NC}  (${yellow}$pending${NC} pending)";;
 "etn-cur-usd") echo -en "$""$minedVal mined - ${white}$""$usdVal${NC} Total";;
 "pending") echo -en "$pending";;
 "total_mined") echo -en "$acctTotal";;
 "hashrate") echo -en "$estimated_hashrate";;
esac

} ##etn_account
