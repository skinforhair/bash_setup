#!/bin/bash

containsElement () {
  local e
  for e in "${@:2}"; do [[ "$e" == "$1" ]] && return 0; done
  return 1
}


function fix_words() {
  case "$1" in
   "Sci-Fi") stringZ="Science Fiction";;
   "Comic") stringZ="Comics";;
   *) stringZ="$1"
  esac

echo "$stringZ"
} #END fix_words

function merge_terms(){
 sList=$(echo "select $1 from $shelfTable where id=${searchTerms[25]}" |mysql $dbOptions)
 cList=$(echo "select $1 from $collectionTable where id=${searchTerms[23]}" |mysql $dbOptions)
 mList=$2
counter=0
myArray=

IFS=','
 read -a s <<< "$sList"
 read -a c <<< "$cList"
 read -a m <<< "$mList"

for i in ${m[@]}; do
 if [ "${i:0:1}" == " " ]; then
   i=${i:1}
 fi
 myArray[$counter]="${i^}"
 counter=$((counter+1))
done

for i in ${s[@]}; do
  if [ "${i:0:1}" == " " ]; then
   i=${i:1}
 fi
 stringZ=`echo "${i^}"`
 stringZ=$(fix_words "$stringZ")
 containsElement "$stringZ" "${myArray[@]}"
 if [ "$?" == "1" ]; then
  myArray[$counter]="$stringZ"
  counter=$((counter+1))
 fi
done

for i in ${c[@]}; do
  if [ "${i:0:1}" == " " ]; then
   i=${i:1}
 fi
 stringZ=`echo "${i^}"`
 stringZ=$(fix_words "$stringZ")
 containsElement "$stringZ" "${myArray[@]}"
 if [ "$?" == "1" ]; then
  myArray[$counter]="$stringZ"
  counter=$((counter+1))
 fi
done

#Add the rifftrax tag
if [ "$3" == "1" ]; then
 containsElement "Rifftrax" "${myArray[@]}"
 if [ "$?" == "1" ]; then
   myArray[$counter]="Rifftrax"
   counter=$((counter+1))
 fi
fi


outputString=""
for i in ${myArray[@]}; do
 if [ "${i:0:1}" == " " ]; then
   i=${i:1}
 fi
 outputString="$outputString,$i"
done
 outputString=${outputString:1}

#echo "$1 :"
#echo -e "${myArray[@]}"

echo "$outputString"

} #END merge_terms
