#!/bin/bash
function build_country_list(){
 for i in $TMP $CountryList; do
  [ -f "$i" ] && rm -f $i
 done

 URL="http://ipdeny.com/ipblocks/"
 PageDump=`lynx -width 1000 -dump $URL |grep "download zone file"`

 echo "$PageDump" >> $TMP
 while read s; do
  country_name="${s%%(*}"
  country_code="${s#*(}"
  country_code="${country_code%%)*}"
  [ "$country_code" == "VATICAN CITY STATE" ] && country_code="VA"
  [ "$country_code" == "VA" ] && country_name="$country_name (VATICAN CITY STATE)"
 # if [ "$(grep ${country_code,,} ${WHITELIST})" == "" ]; then
   echo "${country_code,,}  #${country_name}" >> $CountryList
   echo "http://ipdeny.com/ipblocks/data/aggregated/${country_code,,}-aggregated.zone" >> $AllZONES
   echo -en "."
  #fi  
 done < $TMP
 echo ""
 rm -f $TMP
 sort $CountryList > $CountryList
} ##build_country_list

